<!doctype html>
<html>
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <title>MOTKsheets G-Viewer</title>
    <?!= include('CoreStyles'); ?>
  </head>
  <body>
    <?!= include('BarGnavi'); ?>  
    <?!= include('BarPnavi'); ?>  
    <?!= include('Scripts'); ?>

    <main id="main-content">
      <div class="loader">Loading...</div>
    </main>

    <script>
      const PAGE = "<?= page ?>";
      window.SCRIPT_URL = "<?= scriptUrl ?>";

      // ★★★★★★★ お客様の元のデータ形式 ★★★★★★★
      const raw = JSON.parse(<?= dataJson ?>);

      // 元のコードの通り、rawからデータを分離
      const ids = raw.length > 0 ? raw[0] : [];
      const header = raw.length > 1 ? raw[1] : [];
      const dataRows = raw.length > 2 ? raw.slice(2) : [];

      const ALL_DATA = {
        pageType: "table",
        sheetName: PAGE,
        ids: ids,
        header: header,
        total: dataRows.length,
        rows: dataRows,
        fieldMeta: [],
        idMaps: {},
      };
      
      // 私が追加したhydrate関数は不要なため削除
    </script>

    <script src="<?= scriptUrl ?>?action=app-bundle"></script>
    <?!= include('viewer'); ?>

    <script>
      // DOMロード後にboot()が一度だけ実行される、元のシンプルなフロー
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof boot === 'function') {
          boot();
        }
        const loader = document.querySelector('.loader');
        if (loader) {
          loader.style.display = 'none';
        }
      });
    </script>
  </body>
</html>