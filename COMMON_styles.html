<!-- ===== COMMON_styles.html ===== -->
<style>
  .field-cell { display: inline-block; min-width: 100px; }
  .originals-link { color: #007bff; text-decoration: none; font-weight: bold; }
  .originals-link:hover { text-decoration: underline; }
  .no-link { color: #6c757d; font-style: italic; }
  .entity-link { color: #28a745; text-decoration: none; }
  .entity-link:hover { text-decoration: underline; }
  .card { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
  .card-fields .field { margin: 5px 0; }
  .input { border: 1px solid #ccc; padding: 2px; }
  .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
  .modal-content { background: white; margin: 15% auto; padding: 20px; width: 80%; max-width: 500px; }
  table td { vertical-align: top; padding: 5px; }
  /* Gridstack/Card/Pagination: Styled but structured in page files */
  .grid-stack { background: #f8f9fa; }
  .grid-stack-item { border: 1px solid #dee2e6; }
  .pagination { text-align: center; margin: 10px 0; }
</style>

<style>
  :root {
    --bg-primary: #ffffff;
    --fg-primary: #111111;
    --bg-secondary: #f0f0f0;
    --border-color: #cccccc;
    --link-color: #4ea3ff;
    --link-hover-color: #ff7e39;
    --header-height: 40px;
    --pnav-height: 40px; /* NOTE: legacy comment removed */
    --statusbar-height: 28px;
    --total-header-height: calc(var(--header-height) + var(--pnav-height));
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --bg-primary: #1e1e1e;
      --fg-primary: #e0e0e0;
      --bg-secondary: #333333;
      --border-color: #555555;
      --link-color: #71c1ff;
    }
  }

  html, body {
    margin: 0;
    padding: 0;
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue",
      Arial, sans-serif;
    background-color: var(--bg-primary);
    color: var(--fg-primary);
    overflow: hidden;
  }

  #gNav,
  #pNav {
    position: fixed;
    left: 0;
    right: 0;
    z-index: 300;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0 12px;
    background-color: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    box-sizing: border-box;
  }
  #gNav {
    top: 0;
    height: var(--header-height);
  }
  #pNav {
    top: var(--header-height);
    height: var(--pnav-height);
  }

  #main-content {
    position: fixed;
    top: var(--total-header-height);
    left: 0;
    right: 0;
    bottom: 0;
  }


/* ===== 2. Table View Styles ===== */
/* Root vars for viewer-specific (merged with global) */
:root{
  --surface:var(--bg-primary);
  --panel:var(--bg-secondary);
  --border:var(--border-color);
  --toolbar-h:29px;
  --nav-offset:0px;
  --sbw:12px;
  /* ↓ フッター高さぶんの下余白（JSで実測反映）。デフォルトは安全側 */
  --footer-pad:96px;
}

#table-view-container {
  position: fixed;
  top: var(--total-header-height);
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  background: var(--surface);
  font: 13px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  overflow: hidden;
  scrollbar-color:#cbd5e1 #0f1420;
  scrollbar-width:thin;
}


/* Toolbar */
#toolbar{
  flex:0 0 auto;display:flex;align-items:center;gap:8px;min-height:var(--toolbar-h);
  padding:4px 8px;background:var(--panel);border-bottom:1px solid var(--border);
  position:sticky;
  top: 0; /* ← 親コンテナの最上部に固定 */
  z-index:100;font-size:13px;
}
#toolbar .btn{padding:3px 9px;border:1px solid var(--border);border-radius:4px;background:var(--surface);cursor:pointer;}
#toolbar .btn:disabled{opacity:.5;cursor:not-allowed;}
#toolbar .btn:hover:not(:disabled){background:var(--panel);}
#toolbar select,#toolbar input[type="search"]{padding:3px 8px;}
.spacer{flex:1 1 auto;}
.muted{opacity:.7;}
#quickSearch{min-width:240px;}

/* Table wrapper（横スクロール＋下余白を“常に”確保） */
#tableWrap{
  flex:1 1 auto;
  min-height:0;
  position:relative;
  overflow-x:auto;
  overflow-y:auto;
  background:var(--surface);
  /* ← フッター高さぶんの余白を CSS 変数で確保（JSが実測で更新） */
  padding-bottom:var(--footer-pad, 96px);

  /* ← 明るめ＋detail同等の配色（Firefox） */
  scrollbar-color:#cbd5e1 #0f1420;
  scrollbar-width:thin;
}
/* WebKit 系スクロールバー（detail同等） */
#tableWrap::-webkit-scrollbar,
#table-view-container::-webkit-scrollbar{width:var(--sbw);height:var(--sbw);}
#tableWrap::-webkit-scrollbar-thumb,
#table-view-container::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:6px;}
#tableWrap::-webkit-scrollbar-track,
#table-view-container::-webkit-scrollbar-track{background:#0f1420;}

#tableWrap > table{
  display:block;
  width:max-content;     /* 内容幅に合わせる → 横スクロール出る */
  min-width:100%;
  border-collapse:separate;border-spacing:0;margin:0;background:var(--surface);
  table-layout:fixed;font-size:13px;
}
#tableWrap table thead{display:table-header-group;}
#tableWrap table tbody{display:table-row-group;}

#tableWrap table th,#tableWrap table td{
  white-space:normal;padding:5px 8px;border-bottom:1px solid var(--border);
  border-right:1px solid var(--border); /* 縦線 */
  background:var(--surface);overflow:hidden;min-width:56px;word-break:break-word;
}
/* 末尾列は右罫線なし */
#tableWrap table th:last-child,#tableWrap table td:last-child{ border-right:none; }

#tableWrap table thead th{
  position:sticky;top:0;z-index:20;background:var(--panel);
  border-bottom:1px solid var(--border);user-select:none;text-align:left;
  padding:3px 8px;line-height:1.2;
}
th{position:relative;}
th.draggable{cursor:move;}
.resize-h{position:absolute;top:0;right:0;width:8px;height:100%;cursor:col-resize;user-select:none;}

/* Footer (status + pager) — stickyで最前面。ただし #tableWrap の padding-bottom で被らない */
#statusBar{
  position:sticky;        /* ← sticky フッター */
  bottom:0;
  z-index:101;
  flex:0 0 auto;
  background:var(--panel);
  border-top:1px solid var(--border);
  display:flex;align-items:center;gap:8px;
  padding:6px 8px;
}
#pager{display:flex;align-items:center;gap:8px;}
#pager .btn{padding:4px 10px;border:1px solid var(--border);border-radius:4px;background:var(--surface);cursor:pointer;min-width:34px;}
#pager .btn:disabled{opacity:.5;cursor:not-allowed;}
#perPage{padding:4px 8px;}
#pageSelect{padding:4px 6px;min-width:70px;max-width:180px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:inherit;}

/* Panels（はみ出さない） */
.panel{
  position:fixed;display:none;z-index:10000;background:var(--panel);border:1px solid var(--border);border-radius:8px;
  padding:10px;box-shadow:0 10px 28px rgba(0,0,0,.18);
  max-height:72vh;overflow:auto;
  min-width:320px;max-width:min(92vw,640px);width:min(92vw,640px);
  font-size:13px;
}
.panel .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--border);}
.panel .btn{padding:4px 10px;border:1px solid var(--border);border-radius:6px;background:var(--surface);cursor:pointer;}
.panel .btn:hover{background:var(--panel);}
.row{display:flex;align-items:flex-start;gap:8px;padding:4px 0;}
.subtle{opacity:.7;font-size:12px;}
.divider{height:1px;background:var(--border);margin:6px 0;}
.tinyLabel{font-size:11px;opacity:.75;display:block;line-height:1.1;margin-bottom:2px;}

/* Filter groups（見出し） */
.fg-item{border:1px solid var(--border);border-radius:6px;margin:6px 0;}
.fg-head{display:flex;align-items:center;gap:8px;padding:6px;}
.fg-body{padding:6px 8px 8px 10px;border-top:1px dashed var(--border);}
.fg-collapse{cursor:pointer;user-select:none;}
.fg-title{font-weight:600;}

/* Group header rows in table（少し明るい灰色） */
.grp1{background:#f5f6f8;color:inherit;border-left:4px solid #d1d5db;}
.grp2{background:#eef1f5;color:inherit;border-left:4px solid #e5e7eb;}
.grpLabel{display:inline-block;padding:4px 10px;font-weight:600;}

/* Save dropdown */
.dropdown{position:relative;display:inline-block;}
.dd-menu{position:absolute;left:0;top:calc(100% + 6px);background:var(--panel);border:1px solid var(--border);border-radius:8px;min-width:220px;box-shadow:0 10px 28px rgba(0,0,0,.18);display:none;}
.dd-menu.open{display:block;}
.dd-item{padding:8px 12px;cursor:pointer;}
.dd-item:hover{background:rgba(0,0,0,.06);}

/* --- Clone Header Styles --- */
.floating-header-wrapper {
  position: fixed;
  z-index: 220;
  overflow: hidden;
}
.floating-header-wrapper table {
  background-color: var(--bg-secondary);
}
.floating-header-wrapper th {
  background-color: var(--bg-secondary);
  cursor: move;
}

.resizer {
  position: absolute;
  right: 0;
  top: 0;
  width: 5px;
  height: 100%;
  cursor: col-resize;
  user-select: none;
}
.thumb {
  width: 160px;
  height: 90px;
  object-fit: cover;
  display: block;
  cursor: pointer;
}
a {
  color: var(--link-color);
  text-decoration: none;
}
a:hover {
  color: var(--link-hover-color);
  text-decoration: underline;
}
button {
  padding: 4px 10px;
  border-radius: 4px;
  border: 1px solid var(--border-color);
  background-color: var(--bg-primary);
  color: var(--fg-primary);
  cursor: pointer;
}
button:hover {
  background-color: var(--bg-secondary);
}

#hierMenu ul { padding:0.25rem 0; }
#hierMenu li { list-style:none; cursor:pointer; white-space:nowrap; padding:0.25rem 0.75rem; }
#hierMenu li:hover { background:#eef; }
.ship-table th { text-align:left; font-weight:600; padding-right:0.5rem; }
.ship-table td { padding-left:0.5rem; }

#gNav a,#pNav a{cursor:pointer;display:inline-block;padding:0 6px}




  /* ===== Detail Page ===== */
html.detail-root{
      --bg:#0b0c0f; --fg:#e6eaf0; --fg-dim:#9aa3b2;
      --gap:12px; --cols:12; --rowh:12px;
      --min-col:120px;
      --card-bg:rgba(255,255,255,.04); --card-bd:rgba(255,255,255,.12); --card-hd:rgba(255,255,255,.03);
      --panel:#151821; --panel-bd:rgba(255,255,255,.12);
      --toolbar-h:48px; --footer-h:22px; --sbw:12px;
    }
html.detail-root{min-height:100%;overflow-y:auto!important;overflow-x:hidden!important;}
body.detail-page{
      min-height:100vh;margin:0;background:var(--bg);color:var(--fg);
      overflow-y:auto!important;overflow-x:hidden!important;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
body.detail-page .toolbar :is(button,
body.detail-page [role="button"],
body.detail-page .btn,
body.detail-page a){pointer-events:auto!important;opacity:1!important}
body.detail-page #gridWrap{position:relative;overflow-x:auto;overflow-y:visible;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none;}
body.detail-page #gridWrap::-webkit-scrollbar{width:0;height:0;}
body.detail-page #hScroll{
      position:fixed;z-index:1201;left:0;width:100%;
      height:12px;overflow-x:auto;overflow-y:hidden;background:transparent;border:none;border-radius:0;
    }
body.detail-page #hScroll::-webkit-scrollbar{height:12px;}
body.detail-page #hScroll::-webkit-scrollbar-track{background:#0f1420;}
body.detail-page #hScroll::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:6px;}
body.detail-page #hScroll{scrollbar-color:#cbd5e1 #0f1420;scrollbar-width:thin;}
body.detail-page #hScrollInner{height:1px;}
body.detail-page .toolbar{
      position:fixed; left:0; right:0;
      top:calc(var(--gnav-height,40px) + var(--pnav-height,40px));
      z-index:1200; height:var(--toolbar-h);
      display:grid; grid-template-columns:1fr auto; align-items:center;
      padding:0 12px; background:rgba(20,23,28,.96);
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter:saturate(120%) blur(6px);
      transition:background .15s ease;
    }
body.detail-page.layout-edit .toolbar{ background:rgba(45,28,28,.96); }
body.detail-page .toolbar-center{
      position:absolute; left:50%; top:50%; transform:translate(-50%, -50%);
      pointer-events:none; z-index:1250;
    }
body.detail-page .toolbar-center .mode-badge{
      display:inline-block; border:none; background:transparent; color:#f3f4f6;
      font-weight:700; font-size:12px; padding:0; letter-spacing:.04em;
    }
body.detail-page .footer-bar{
      position:fixed; left:0; right:0; bottom:0; height:var(--footer-h);
      background:rgba(20,23,28,.92); color:#cbd5e1;
      display:flex; align-items:center; gap:12px; padding:0 12px;
      border-top:1px solid rgba(255,255,255,.08);
    }
body.detail-page .spacer-top{ height:calc(var(--gnav-height,40px) + var(--pnav-height,40px) + var(--toolbar-h)); }
body.detail-page .spacer-bottom{ height:var(--footer-h); }
body.detail-page #grid{
      position:relative;overflow:visible;display:grid;gap:var(--gap);
      grid-template-columns:repeat(var(--cols),var(--min-col));
      grid-auto-rows:var(--rowh);align-content:start;
      min-width:calc(var(--cols)*var(--min-col) + (var(--cols)-1)*var(--gap));
      min-height:50vh;
    }
body.detail-page /* NOTE: legacy comment removed */
    #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid){
      display:grid!important;grid-template-columns:max-content 1fr!important;align-items:start;gap:8px;
    }
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) .k{white-space:nowrap;text-align:left;overflow:hidden;text-overflow:ellipsis;}
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) .v{min-width:160px}
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) [contenteditable="true"]{contenteditable:false;}
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) input,
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) select,
body.detail-page #grid :is(.field-row,
body.detail-page .kv-row,
body.detail-page .fields-grid) textarea{
      pointer-events:none!important;background:transparent!important;border-color:transparent!important;
    }
body.detail-page .btn,
body.detail-page .select,
body.detail-page .input{
      height:30px;padding:0 10px;border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);color:var(--fg);font-size:12px;
      flex:0 0 auto; line-height:28px; white-space:nowrap;
    }
body.detail-page .btn:hover{background:rgba(255,255,255,.12);}
body.detail-page .mode-toggle{
      height:30px; padding:0 12px; font-weight:700; letter-spacing:.4px;
      border:1px solid rgba(255,255,255,.24);
      background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color:#fff; border-radius:8px; cursor:pointer; line-height:28px;
    }
body.detail-page.layout-edit .mode-toggle{
      background:linear-gradient(180deg, rgba(255,120,120,.22), rgba(255,120,120,.10));
      border-color:rgba(255,120,120,.5);
    }
body.detail-page #presetSelect{
      background:#fff !important; color:#000 !important;
      border:1px solid #111 !important; border-radius:8px;
      padding:0 10px; height:30px; font-size:12px; line-height:28px;
    }
body.detail-page #presetSelect option{ background:#fff; color:#000; }
body.detail-page /* NOTE: legacy comment removed */
    .menu{
      position:absolute; right:0; top:calc(100% + 6px);
      background:#fff; color:#000;
      border:1px solid rgba(0,0,0,.15);
      border-radius:10px; min-width:160px;
      display:none; /* NOTE: legacy comment removed */
      flex-direction:column; overflow:hidden; z-index:1400;
      box-shadow:0 10px 24px rgba(0,0,0,.2);
    }
body.detail-page .menu.open{ display:flex; }
body.detail-page /* NOTE: legacy comment removed */
    .menu .mi{
      padding:8px 10px; cursor:pointer; font-size:12px;
      white-space:nowrap; color:#000; background:#fff;
    }
body.detail-page .menu .mi:hover{ background:#f2f2f2; }
body.detail-page .toolbar .right{ display:flex; align-items:center; gap:8px; flex-wrap:nowrap; }
body.detail-page .toolbar .right > *{ white-space:nowrap; }
body.detail-page .card{
      position:relative;background:var(--card-bg); border:1px solid var(--card-bd);
      border-radius:12px; overflow:hidden; display:flex; flex-direction:column;
      --thwpx: 220px; min-height:calc(var(--rowh) * 6);
    }
body.detail-page .card-header{
      display:flex;align-items:center;justify-content:space-between;gap:8px;
      padding:8px 10px;background:var(--card-hd);border-bottom:1px solid rgba(255,255,255,.08);
      font-size:12px;font-weight:600;cursor:grab; user-select:none; flex:0 0 auto;
    }
body.detail-page .card-header:active{cursor:grabbing;}
body.detail-page .card-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
body.detail-page .card-actions{display:none;align-items:center;gap:6px}
body.detail-page .layout-edit .card-actions{display:flex}
body.detail-page .cbody{min-height:0; flex:1 1 auto; overflow:auto;}
body.detail-page .card[data-type="shotview"] .cbody{ overflow:hidden; }
body.detail-page .resize{position:absolute;right:6px;bottom:6px;width:12px;height:12px;border-right:2px solid rgba(255,255,255,.6);border-bottom:2px solid rgba(255,255,255,.6);border-radius:2px;cursor:nwse-resize;display:none}
body.detail-page .layout-edit .resize{display:block}
body.detail-page .card.dragging{opacity:.7;outline:1px dashed rgba(255,255,255,.4)}
body.detail-page .table{width:100%;border-collapse:collapse;font-size:12px;table-layout:auto;}
body.detail-page .table th,
body.detail-page .table td{padding:6px 10px;vertical-align:top;border-bottom:1px dashed rgba(255,255,255,.06)}
body.detail-page .table th{
      width:1% !important; text-align:left !important; color:var(--fg-dim);
      font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
body.detail-page .table td{color:var(--fg);word-break:break-word}
body.detail-page .media{width:100%; height:100%; background:#0f1115;}
body.detail-page .media.aspect{ position:relative; width:100%; }
body.detail-page .media.aspect::before{ content:""; display:block; padding-top:56.25%; }
body.detail-page .media.aspect .inner{ position:absolute; inset:0; }
body.detail-page .media iframe{ width:100%; height:100%; border:0; background:#0f1115; }
body.detail-page .media-note{padding:8px 10px;font-size:12px;color:#9aa3b2}
body.detail-page .modal{ position:固定; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.45); z-index:40000; }
body.detail-page .panel{
      position:relative; z-index:40001;
      width:min(640px,92vw); max-height:80vh; overflow:auto;
      background:var(--panel); border:1px solid var(--panel-bd); border-radius:12px;
      box-shadow:0 18px 48px rgba(0,0,0,.5);
    }
body.detail-page .panel .hd{padding:10px 12px; border-bottom:1px solid var(--panel-bd); font-weight:600}
body.detail-page .panel .bd{padding:12px}
body.detail-page .panel .ft{padding:10px 12px; border-top:1px solid var(--panel-bd); display:flex; gap:8px; justify-content:flex-end}
body.detail-page .row{display:flex; gap:8px; align-items:center; margin-bottom:8px}
body.detail-page .row .grow{flex:1 1 auto}
body.detail-page /* NOTE: legacy comment removed */
    .field-row{
      display:grid; grid-template-columns:auto 1fr; gap:8px; align-items:center;
      padding:6px 0; border-bottom:1px dashed rgba(255,255,255,.08);
    }
body.detail-page .field-row input[type="checkbox"]{ width:16px; height:16px; margin:0; }
body.detail-page .field-row label{
      font-size:12px; color:var(--fg);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
body.detail-page .xbtn{cursor:pointer;padding:2px 6px;border:1px solid rgba(255,255,255,.3);border-radius:6px}
body.detail-page .list-row{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;align-items:center;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,.08)}
body.detail-page .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:3px 8px; margin:2px 6px 2px 0; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      font-size:11px; white-space:nowrap;
    }

  /* ===== 90.saveas-modal-styles ===== */
  #pgSaveAsMask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:999}
  #pgSaveAs{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);min-width:360px;background:#fff;border:1px solid #ddd;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:none;z-index:1000}
  #pgSaveAs .hd{padding:12px 14px;border-bottom:1px solid #eee;font-weight:600}
  #pgSaveAs .bd{padding:14px;display:grid;gap:10px}
  #pgSaveAs .ft{padding:12px 14px;border-top:1px solid #eee;display:flex;gap:8px;justify-content:flex-end}
  #pgSaveAs input, #pgSaveAs select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box}
  #pgSaveAs .row{display:grid;gap:6px}
  #pgSaveAs label{font-size:12px;color:#555}
  /* ===== 90. End ===== */

</style>
<!-- ===== COMMON_styles.html End ===== -->
