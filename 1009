MOTKgas6.2　10/09/2025
# ここまでの状況まとめ

* **環境**

  * Google Apps Script（GAS）製のビューア。`Debug Panel` で自己診断。
  * シート構成：`Shots / Assets / Tasks / ProjectMembers / Users / project_meta / Fields`。

* **データ定義（問題なし）**

  * 各エンティティのフィールドは検出済み（`entity_name`=fi_0002/0016/0026/0035/0045）。
  * リンク型は新仕様（`*_link`）に統一、レガシー`entity_link`なし。
  * `Fields matrix` 正常、`Link type sanity` OK。

* **件数**

  * shots=289 / assets=13 / tasks=18 / users=3 / members=15。

* **Project Meta**

  * `originals_root_url` と `proxies_root_url` の両方設定済み。
  * `Shot/Scene/Act` のルート有効フラグも取得できている。

* **Originals/Proxies まわり**

  * サーバ関数を実装：

    * `sv_getOriginalsFolderUrl`（別名`sv_getOriginalsUrl`等）
    * `sv_getLinkMaps`
    * `sv_listEntityProxies` / `sv_listLatestProxyBatch` / `sv_indexAllProxies`
  * `sh_0001` の Originals は最初「not found」→ フォールバックで **実URL発見**：

    * `https://drive.google.com/drive/folders/19PocSJnO527w53XnN2Rr8HeooqmINCFy`
  * ルックアップは「シート値 → ルート直下再帰」の順でフォールバック。

* **Rows 取得（正常）**

  * `SV.listRowsPage({entity:'shot'})` などで **実データ返却**確認（サンプル行表示済み）。
  * 列ヘッダ2段/1段の自動判定・フィールド推定も動作。

* **発生している問題（核心）**

  * **「Tableページで entity が見つからない」**。
  * 原因は **entity名の不一致（複数形・別名）**：

    * クライアントが `shots / assets / ProjectMembers` などを渡し、
    * サーバ側が `shot/asset/member/user/task` の **単数・正規化**のみを想定。

* **対処方針（提案）**

  1. **サーバ側正規化**（一度入れれば全ページで有効）

     * `req.entity` を `shot/asset/task/member/user` に正規化する `_normEntity` を実装し、`sv_listRowsPage` 等の入口で必ず適用。
  2. **クライアント側も保険で正規化**

     * URL/ページ設定の `entity` を受けて `shots→shot`、`ProjectMembers/Members→member` へ変換してから RPC 呼び出し。
  3. **Page レコード（fi_0055: Entity）**

     * 可能なら値を **単数の正規名** に統一（`shot/asset/task/member/user`）。

* **現在の健康状態**

  * サーバ API・データ・メタは健全。
  * `listRowsPage` は直接呼べば結果が出るため、問題は **Tableページの entity 解析/受け渡し** に限定。

* **この後に必要な変更**

  * 上記の **正規化実装**（サーバ1箇所＋クライアント1箇所）
  * `Page.Entity` の値を単数にそろえる（任意だが推奨）。

以上です。
